<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Gordy</title>
  <link rel="icon" type="image/png" href="/static/logo.png">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const currentUser = localStorage.getItem('loggedInUser');
      if (!currentUser) {
        window.location.href = '/';
      }
    });
  </script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background-color: #212121;
      color: #E0E0E0;
    }
    .app-container {
      position: relative;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .hamburger,
    #top-new-chat-btn {
      flex-shrink: 0;
    }
    .top-nav .hamburger {
      display: block;
    }
    .down-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 1);
      color: #fff;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-size: 2rem;
      text-align: center;
    }
    .app-container.sidebar-open .top-nav {
      margin-left: 260px;
      width: calc(100% - 260px);
    }
    .glass-panel {
      backdrop-filter: blur(20px);
      background: rgba(0,0,0,0.4);
      box-shadow: 0 8px 32px rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      transition: box-shadow 0.3s ease;
    }
    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      z-index: 10;
      position: relative;
      background-color: #212121;
      border: none;
      box-shadow: none;
      transition: margin-left 0.3s ease, width 0.3s ease;
      width: 100%;
    }
    .top-nav .actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .hamburger {
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: inline-block;
      fill: #E0E0E0;
      padding: 4px;
      box-sizing: content-box;
    }
    .model-select {
      background: rgba(255,255,255,0.15);
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      outline: none;
    }
    .main-content {
      flex: 1;
      display: flex;
      overflow: hidden;
      padding: 0px;
      gap: 0px;
      transition: all 0.3s ease;
      margin-left: 0;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 260px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.3s ease;
      padding: 16px;
      border-radius: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(20px);
      z-index: 900;
    }
    .sidebar.collapsed {
      transform: translateX(-100%);
    }
    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 0px;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    .sidebar-content #chat-list {
      margin-top: 60px;
    }
    .sidebar.collapsed .sidebar-content {
      opacity: 0;
    }
    .chat-history-item {
      padding: 10px;
      border-radius: 10px;
      transition: background-color 0.3s ease, color 0.3s ease;
      cursor: pointer;
      margin-bottom: 8px;
      background: rgba(33, 33, 33, 1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      color: #E0E0E0;
    }
    .chat-history-item.selected,
    .chat-history-item:hover {
      background: #333;
      color: #FFF;
    }
    .chat-history-item .chat-title {
      display: flex;
      align-items: center;
      flex-grow: 1;
      overflow: hidden;
    }
    .chat-history-item .chat-title span {
      margin-left: 0.5rem;
      flex-grow: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .options-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #E0E0E0;
      font-size: 1.2rem;
      padding: 0 5px;
      margin-left: 10px;
      position: relative;
      transition: color 0.3s ease;
    }
    .options-menu {
      position: absolute;
      right: 0;
      top: 35px;
      background: rgba(0,0,0,0.85);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 5px 0;
      display: none;
      flex-direction: column;
      z-index: 999;
      animation: fadeInScale 0.2s forwards;
    }
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    .options-menu button {
      background: none;
      border: none;
      color: #fff;
      text-align: left;
      padding: 10px;
      width: 100%;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }
    .options-menu button:hover {
      background: rgba(255,255,255,0.1);
    }
    .btn {
      width: 100%;
      padding: 12px;
      background: rgba(255,255,255,0.15);
      border: none;
      color: #fff;
      font-weight: 600;
      margin-bottom: 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.1s ease;
      outline: none;
    }
    .info-section {
      margin-top: 20px;
      font-size: 0.9rem;
      color: #ccc;
    }
    .info-section strong {
      color: #fff;
    }
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      transition: margin-left 0.3s ease, width 0.3s ease;
      margin-left: 0;
      width: 100%;
    }
    .messages-container {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background-color: #212121;
      padding: 10px;
      height: calc(100vh - 120px);
      max-height: calc(100vh - 120px);
      scroll-behavior: smooth;
      padding-bottom: 80px;
    }
    .messages-container.no-chat {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
    }
    .homepage-heading {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 10px;
      color: #fff;
      text-shadow: 0 2px 5px rgba(0,0,0,0.3);
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    .greeting {
      font-size: 2rem;
      font-weight: 600;
      color: #fff;
      text-align: center;
      margin-bottom: 10px;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
    .input-area-home {
      width: 100%;
      max-width: 600px;
      display: flex;
      align-items: center;
      position: relative;
      margin-bottom: 0px;
      padding: 0;
    }
    .input-area-home textarea {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: none;
      color: #fff;
      padding: 16px 20px;
      border-radius: 30px;
      outline: none;
      transition: background 0.3s ease;
      font-size: 1rem;
      resize: none;
      min-height: 40px;
      overflow: hidden;
    }
    .input-area-home textarea:focus {
      background: rgba(255,255,255,0.2);
      outline: 2px solid #6366F1;
    }
    .home-send-btn {
      position: absolute;
      right: 12px;
      background: #6366F1;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.1s ease;
    }
    .home-send-btn:hover {
      background: #4F46E5;
      box-shadow: 0 0 8px rgba(99,102,241,0.6);
      transform: translateY(-1px) scale(1.02);
    }
    .home-send-btn svg {
      width: 20px;
      height: 20px;
      stroke: #fff;
      stroke-width: 2;
    }
    .examples-section {
      text-align: center;
      max-width: 600px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      margin-top: 30px;
      padding: 20px;
    }
    .examples-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: #fff;
    }
    .examples-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      width: 100%;
    }
    @media(min-width: 640px) {
      .examples-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    @media(min-width: 1024px) {
      .examples-grid {
        grid-template-columns: 1fr 1fr 1fr;
      }
    }
    .example-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      color: #fff;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    .example-icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      fill: #7C3AED;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .message {
      width: auto;
      max-width: 60%;
      margin-bottom: 15px;
      position: relative;
      border-radius: 15px;
      padding: 12px 18px;
      animation: fadeInUp 0.5s forwards;
    }
    .ai-message {
      background-color: #212121;
      color: #fff;
      align-self: flex-start;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      position: relative;
    }
    .ai-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .ai-text {
      display: inline-block;
      max-width: calc(100% - 50px);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .user-message {
      background-color: #303030;
      color: #fff;
      align-self: flex-end;
      position: relative;
    }
    .user-text {
      display: block;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .user-message .unsend-btn {
      position: absolute;
      top: 5px;
      right: 10px;
      background: none;
      border: none;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }
    .user-message:hover .unsend-btn {
      opacity: 1;
    }
    .unsend-btn:hover {
      color: #FF6666;
    }
    .input-area {
      position: fixed;
      bottom: 20px;
      left: 0;
      width: 100%;
      background-color: #212121;
      padding: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 1000;
      height: auto;
      border-radius: 10px;
    }
    .messages-container::-webkit-scrollbar {
      display: none;
    }
    .messages-container {
      scrollbar-width: none;
    }
    .messages-container {
      -ms-overflow-style: none;
    }
    .input-area textarea {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: none;
      color: #fff;
      padding: 14px 60px 14px 60px;
      border-radius: 30px;
      outline: none;
      transition: background 0.3s ease;
      font-size: 1rem;
      resize: none;
      min-height: 40px;
      max-height: 120px;
      overflow-y: auto;
    }
    .input-area textarea:focus {
      background: rgba(255,255,255,0.2);
      outline: 2px solid #6366F1;
    }
    .send-btn {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.1);
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 2;
    }
    .send-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 4px 10px rgba(255, 255, 255, 0.3);
    }
    .send-btn svg {
      width: 24px;
      height: 24px;
      stroke: rgba(255, 255, 255, 0.8);
      transition: stroke 0.3s ease;
    }
    .new-chat-btn-container {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .new-chat-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      background: none;
      border: none;
      box-shadow: none;
      transition: transform 0.2s ease-in-out;
    }
    .new-chat-icon {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    .sidebar.collapsed .new-chat-btn-container {
      top: 16px;
      left: 48px;
      right: auto;
    }
    .code-block {
      background: rgba(0,0,0,0.5);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      position: relative;
      width: 100%;
    }
    .code-block code {
      white-space: pre;
    }
    .copy-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #4CAF50;
      border: none;
      color: #fff;
      padding: 5px 8px;
      font-size: 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .code-block:hover .copy-button {
      opacity: 1;
    }
    .copied-feedback {
      background-color: #4CAF50;
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 0.8em;
    }
    .advanced-spinner {
      display: inline-block;
      width: 80px;
      height: 80px;
      position: relative;
      margin-left: 10px;
      vertical-align: middle;
    }
    .advanced-spinner .layer {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 80px;
      height: 80px;
      transform: translate(-50%, -50%) rotate(0deg);
      animation: rotateLayer 12s linear infinite;
    }
    .advanced-spinner .layer:nth-child(1) {
      animation-duration: 12s;
      animation-direction: normal;
    }
    .advanced-spinner .layer:nth-child(2) {
      animation-duration: 8s;
      animation-direction: reverse;
    }
    .advanced-spinner .layer:nth-child(3) {
      animation-duration: 10s;
      animation-direction: normal;
    }
    .advanced-spinner .layer:nth-child(4) {
      animation-duration: 14s;
      animation-direction: reverse;
    }
    .advanced-spinner .layer .shape {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      background: #6366F1;
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(1);
      animation: morphShape 12s ease-in-out infinite, fadeInOut 12s ease-in-out infinite;
    }
    .advanced-spinner .layer:nth-child(1) .shape {
      background: #6366F1;
      animation-duration: 12s;
      box-shadow: 0 0 10px #6366F1;
    }
    .advanced-spinner .layer:nth-child(2) .shape {
      background: #34D399;
      animation-duration: 8s;
      border-radius: 4px;
      box-shadow: 0 0 10px #34D399;
    }
    .advanced-spinner .layer:nth-child(4) .shape {
      background: #F59E0B;
      animation-duration: 14s;
      clip-path: polygon(
        25% 6.7%,
        75% 6.7%,
        100% 50%,
        75% 93.3%,
        25% 93.3%,
        0% 50%
      );
      box-shadow: 0 0 10px #F59E0B;
    }
    @keyframes rotateLayer {
      from {
        transform: translate(-50%, -50%) rotate(0deg);
      }
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }
    @keyframes morphShape {
      0%, 100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
      }
      25% {
        transform: translate(-50%, -50%) scale(1.3) rotate(45deg);
      }
      50% {
        transform: translate(-50%, -50%) scale(0.8) rotate(90deg);
      }
      75% {
        transform: translate(-50%, -50%) scale(1.1) rotate(135deg);
      }
    }
    @keyframes fadeInOut {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }
    .modal-overlay {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.7);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:9999;
    }
    .modal {
      backdrop-filter: blur(20px);
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow:0 8px 32px rgba(0,0,0,0.5);
      padding:20px;
      border-radius:16px;
      width:300px;
      animation: fadeInScale 0.3s forwards;
    }
    @keyframes fadeInScale {
      from {
        opacity:0;
        transform:scale(0.95);
      }
      to {
        opacity:1;
        transform:scale(1);
      }
    }
    .modal h2 {
      margin-bottom:20px;
      color:#fff;
      font-size:1.5rem;
      text-align:center;
    }
    .modal .error-message {
      color: #ff6666;
      font-size:0.9rem;
      margin-bottom:10px;
      text-align:center;
    }
    .modal input {
      width:100%;
      padding:10px;
      margin-bottom:10px;
      border-radius:8px;
      background: rgba(255,255,255,0.1);
      border:none;
      color:#fff;
      outline:none;
    }
    .modal input:focus {
      outline:2px solid #6366F1;
    }
    .modal button {
      width:100%;
      padding:12px;
      border:none;
      border-radius:8px;
      background: #6366F1;
      color:#fff;
      font-weight:bold;
      margin-bottom:10px;
      cursor:pointer;
      transition: background 0.3s ease;
    }
    .modal button:hover {
      background: #4F46E5;
    }
    .modal .toggle-link {
      color: #6366F1;
      cursor:pointer;
      text-align:center;
      display:block;
      margin-top:10px;
      font-size:0.9rem;
    }
    .modal .toggle-link:hover {
      text-decoration: underline;
    }
    .ai-avatar.spinning {
      animation: none;
    }
    .generated-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .dropdown-container {
      display: inline-block;
    }
    .model-select {
      background-color: #212121;
      color: white;
      border: 2px solid #3a3a3a;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 16px;
      outline: none;
      cursor: pointer;
      appearance: none;
      width: 300px;
      position: relative;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 16l-7-8h14l-7 8z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 20px 20px;
    }
    .model-select option {
      background-color: #212121;
      color: white;
      padding: 12px;
      font-size: 14px;
      white-space: normal;
    }
    .model-select:hover,
    .model-select:focus {
      border-color: #4a4a4a;
    }
    .user-status {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #admin-btn {
      margin-left: 10px;
    }
    .admin-button {
      background: #212121;
      color: white;
      border: 1px solid #3a3a3a;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }
    .admin-button:hover {
      background: #2a2a2a;
    }
    .loading-logo {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
    }
    .hidden {
      display: none !important;
    }
    .user-status {
      color: #333;
      font-size: 0.9rem;
      margin-left: 10px;
    }
    .nav-right {
      margin-left: auto;
      padding-right: 1rem;
    }
    .user-status {
      position: relative;
    }
    .profile-trigger {
      cursor: pointer;
    }
    .profile-avatar {
      width: 36px;
      height: 36px;
      background: #2C2C2C;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 500;
      font-size: 16px;
      border: 2px solid #404040;
    }
    .profile-menu {
      position: absolute;
      top: 40px;
      right: 0;
      background: #1e1e1e !important;
      border: 1px solid #404040;
      border-radius: 6px;
      padding: 10px 0;
      min-width: 280px;
      display: none;
      z-index: 1000;
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    }
    .menu-item {
      color: #e0e0e0;
      background-color: transparent;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }
    .menu-item:hover {
      background-color: #2d2d2d;
    }
    .menu-icon {
      width: 28px;
      height: 28px;
      margin-right: 14px;
      flex-shrink: 0;
      filter: brightness(0) saturate(100%) invert(85%) sepia(0%) saturate(0%) hue-rotate(136deg) brightness(80%) contrast(84%);
    }
    .menu-item:last-child img {
      margin-left: 2px;
    }
    .menu-item:nth-child(2) img {
      margin-left: -0.5px;
    }
    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
    .nav-left, .nav-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .profile-menu {
      position: absolute;
      right: 1rem;
      top: 100%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 200px;
      z-index: 1000;
    }
    .menu-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      gap: 0.5rem;
      cursor: pointer;
    }
    .menu-icon {
      width: 20px;
      height: 20px;
    }
    #outage-banner {
      width: 100%;
      box-sizing: border-box;
      padding: 0.5rem;
      font-size: 0.85rem;
      text-align: center;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 999;
      background: #FF6666;
      color: #fff;
    }
    @media screen and (max-width: 768px) {
      .nav-container {
        padding: 0.5rem;
      }
      .profile-menu {
        right: 0;
        width: 100%;
        max-width: 300px;
      }
      .menu-item {
        padding: 1rem;
      }
    }
    @media screen and (max-width: 480px) {
      .nav-left button {
        padding: 0.5rem;
      }
      .profile-menu {
        max-width: 100%;
        right: 0;
      }
    }
    .preview-button {
      position: absolute;
      top: 10px;
      right: 60px;
      background: #2196F3;
      border: none;
      color: #fff;
      padding: 5px 8px;
      font-size: 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .code-block:hover .preview-button {
      opacity: 1;
    }
    .modal-overlay-preview {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .modal-preview {
      position: relative;
      width: 80%;
      height: 80%;
      background: #1e1e1e;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: fadeInScale 0.3s forwards;
    }
    .image-generating {
      width: 50px;
      height: 50px;
      margin-left: 10px;
      vertical-align: middle;
    }
    .modal-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .close-preview-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #FF4136;
      border: none;
      color: #fff;
      padding: 5px 10px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      z-index: 10001;
      transition: background 0.3s ease;
    }
    .close-preview-btn:hover {
      background: #e63946;
    }
    #code-preview-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .messages-container {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background-color: #212121;
      padding: 10px;
      height: calc(100vh - 120px);
      max-height: calc(100vh - 120px);
      scroll-behavior: smooth;
      padding-bottom: 80px;
    }
    .app-container {
      display: flex;
      flex-direction: column;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    @media screen and (max-width: 768px) {
      .message-container {
        padding: 0.5rem;
      }
    }
    .app-container {
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }
    .messages-container {
      padding: 10px;
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }
    .message {
      max-width: 90%;
      word-break: break-word;
    }
    .input-area, .input-area-home {
      padding: 10px;
      width: 100%;
      max-width: 100vw;
      position: fixed;
      bottom: 0;
      left: 0;
      background: #212121;
    }
    @media screen and (max-width: 768px) {
      .top-nav {
        padding: 8px;
      }
      .model-select {
        max-width: 150px;
        font-size: 14px;
      }
      .sidebar {
        width: 80%;
        max-width: 300px;
      }
      .chat-area {
        margin-bottom: 60px;
      }
      .examples-grid {
        grid-template-columns: 1fr;
        padding: 10px;
      }
      .example-card {
        font-size: 14px;
        padding: 15px;
      }
      .ai-message, .user-message {
        padding: 10px;
        margin: 5px 0;
      }
      .ai-avatar {
        width: 35px;
        height: 35px;
      }
      .profile-menu {
        right: 0;
        max-width: 250px;
        font-size: 14px;
      }
    }
    @media screen and (max-width: 480px) {
      .top-nav {
        gap: 5px;
      }
      .model-select {
        max-width: 120px;
      }
      .message {
        max-width: 95%;
      }
      .input-area textarea, .input-area-home textarea {
        font-size: 14px;
      }
    }
    @supports (-webkit-touch-callout: none) {
      .input-area, .input-area-home {
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
      }
      .messages-container {
        padding-bottom: 80px;
      }
      textarea {
        -webkit-appearance: none;
      }
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: rgba(33, 33, 33, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
    }
    .option {
      margin-bottom: 20px;
    }
    .option label {
      display: block;
      color: #fff;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .settings-select, .model-select {
      width: 100%;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
    }
    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .primary-btn, .secondary-btn {
      flex: 1;
      padding: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .primary-btn {
      background: #6366F1;
      color: white;
    }
    .secondary-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    body.light {
      background-color: #f0f0f0;
      color: #333;
    }
    body.light .modal {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    body.light .option label {
      color: #333;
    }
    body.light .settings-select,
    body.light .model-select {
      background: rgba(0, 0, 0, 0.05);
      color: #333;
      border-color: rgba(0, 0, 0, 0.1);
    }
    .message.compact {
      padding: 8px 12px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .message.comfortable {
      padding: 12px 18px;
      margin-bottom: 15px;
      font-size: 16px;
    }
    @media (max-width: 480px) {
      .modal {
        width: 95%;
        padding: 16px;
      }
    }
    .code-block.modern {
      border-radius: 10px;
      border-left: 4px solid #6366F1;
      background: rgba(0,0,0,0.6);
    }
    .code-block.minimal {
      border: none;
      border-radius: 4px;
      background: rgba(0,0,0,0.3);
    }
    .customize-options {
      margin-bottom: 20px;
    }
    .customize-options .option {
      margin-bottom: 15px;
    }
    .customize-options .option label {
      display: block;
      margin-bottom: 5px;
      color: #fff;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #282424;
      color: #E0E0E0;
      text-align: left;
      border-radius: 8px;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
    }
    th {
      background-color: #b8b4b4;
      font-weight: bold;
      padding: 12px;
      border: 1px solid #585454;
      font-family: 'Arial', sans-serif;
    }
    td {
      padding: 12px;
      border: 1px solid #585454;
      font-family: 'Arial', sans-serif;
    }
    tr {
      background-color: #282424;
    }
    tr:nth-child(even) {
      background-color: #282424;
    }
    tr:last-child td {
      background-color: #282424;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      z-index: 10000;
      opacity: 0.9;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .toast.success {
      background-color: #4CAF50;
    }
    .toast.error {
      background-color: #FF4136;
    }
    .toast.info {
      background-color: #2196F3;
    }
    .thinking-text {
        background: linear-gradient(to right, #666666, #b4b4b4, #ffffff, #b4b4b4, #666666);
        background-size: 300% 100%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: fadeColors 2s linear infinite;
      }
      @keyframes fadeColors {
        0%   { background-position: 0% 0%; }
        50%  { background-position: 100% 0%; }
        100% { background-position: 0% 0%; }
      }
      #dropdown-menu {
        background-color: #201c1c;
        border: 1px solid #585454;
        border-radius: 12px;
      }
      #dropdown-menu button {
        transition: background-color 0.3s ease;
        width: 100%;
        border: none;
        background: transparent;
        padding: 8px;
        text-align: left;
        border-radius: 12px;
        outline: none;
        box-shadow: none;
      }
      #dropdown-menu button:focus {
        outline: none;
        box-shadow: none;
      }
      #dropdown-menu button:hover {
        background-color: #302c2c;
      }
      #dropdown-menu svg {
        color: #b4b4b4;
      }
      .dropdown-toggle {
        position: relative;
        top: 12.5px;
        left: 37.5px;
      }
      .thinking-button {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        color: #fff;
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
    
      .thinking-button:hover {
        background-color: rgba(255, 255, 255, 0.15);
      }
    
      .thinking-button svg {
        width: 16px;
        height: 16px;
      }
    
      .thinking-content {
        display: none;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
        white-space: pre-wrap;
        font-family: monospace;
      }
    
      .thinking-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Top Navigation -->
    <div class="top-nav glass-panel">
      <div class="nav-left">
        <!-- Sidebar toggle button -->
        <svg class="hamburger" onclick="toggleSidebar()">
          <image href="static/image.png" width="24" height="24" />
        </svg>
        <!-- New chat button -->
        <button id="top-new-chat-btn" class="new-chat-btn">
          <img src="/static/new-chat.png" alt="New Chat" class="new-chat-icon" />
        </button>
        <div style="display: flex; align-items: center; gap: 10px;">
          <!-- Home Button -->
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.0" stroke="#B4B4B4" class="new-chat-btn cursor-pointer" onclick="window.location.href='/'" title="Home" style="width: 24px; height: 24px; min-width: 24px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <!-- Model Select Dropdown -->
          <select class="model-select form-select" id="model-select" onchange="handleModelChange()">
            <option value="default" data-name="Orion">Orion</option>
            <option value="advanced" data-name="Nebula">Nebula</option>
            <option value="thinking_test" data-name="Thinking still in early beta">Thinking Test </option>
          </select>
        </div>
        <script>
          const modelSelect = document.getElementById('model-select');
          function updateOptionsText() {
            Array.from(modelSelect.options).forEach(option => {
              option.textContent = option.getAttribute('data-name') || '';
            });
          }
          modelSelect.addEventListener('mousedown', updateOptionsText);
          modelSelect.addEventListener('change', updateOptionsText);
          updateOptionsText();
          function handleModelChange() {
            saveUserData();
          }
          handleModelChange();
        </script>
      </div>
      <div class="actions">
        <span id="user-status" class="user-status"></span>
        <button id="logout-btn"></button>
        <button id="admin-btn" onclick="window.open('/admin', '_blank')"></button>
      </div>
      <div class="nav-right">
        <div id="user-status" class="user-status">
          <div class="profile-trigger" onclick="toggleProfileMenu(event)">
            <div class="profile-avatar"></div>
          </div>
          <button id="admin-btn" onclick="window.open('/admin', '_blank')">.</button>
          <div class="profile-menu" id="profile-menu">
            <div class="menu-item" onclick="customizeGordy()">
              <img src="/static/customize.png" class="menu-icon" alt="Customize">
              <span>Customize Gordy</span>
            </div>
            <div class="menu-item" onclick="openSettings()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="menu-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              </svg>
              <span>Settings</span>
            </div>
            <div class="menu-item" onclick="logout()">
              <img src="/static/logout.png" class="menu-icon" alt="Logout">
              <span>Log out</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="outage-banner" class="image-feature-banner glass-panel" style="
      background:rgb(255, 0, 0);
      color: #fff;
      padding: 5px;
      font-size: 0.85rem;
      text-align: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
">
      <span>
        <strong>‚ö†Ô∏è Massive Modle Outage ‚ö†Ô∏è</strong> Most AI models are down right now.
      </span>
      <button onclick="document.getElementById('outage-banner').style.display='none'" style="
          background: none;
          border: none;
          color: #fff;
          font-size: 1rem;
          margin-left: 10px;
          cursor: pointer;
">√ó</button>
    </div>

    <script>
      const showOutageBanner = false; // Set to true to show or false to hide

      if (!showOutageBanner) {
          document.getElementById("outage-banner").style.display = "none";
      }
    </script>

    <div id="experimental-features" class="hidden p-4 bg-gray-700 bg-opacity-50 rounded-lg mt-2 mx-4">
      <h2 class="text-lg font-bold mb-2">Experimental Features</h2>
      <p class="text-sm text-gray-300 mb-2">
        You can try performing a live search using the <code>/search</code> command.
      </p>
      <div class="flex gap-2 items-center">
        <input type="text" id="experimental-search-input" class="flex-1 bg-gray-800 border border-gray-600 rounded p-2 text-white" placeholder="Enter search query">
        <button id="experimental-search-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">Search</button>
      </div>
    </div>

    <div class="sidebar glass-panel collapsed" id="sidebar">
      <div class="sidebar-content">
        <svg class="hamburger" onclick="toggleSidebar()">
          <image href="static/image.png" width="24" height="24" />
        </svg>
        <div id="chat-list"></div>
        <div class="new-chat-btn-container">
          <button id="new-chat-btn" class="new-chat-btn">
            <img src="/static/new-chat.png" alt="New Chat" class="new-chat-icon" />
          </button>
        </div>
        <div class="info-section">
          <div><strong>Messages in Current Chat:</strong> <span id="message-count">0</span></div>
          <div>
            <strong>Tips:</strong>
            <ul>
              <li>Use <code>/search</code> to perform a live search.</li>
              <li>Use <code>/image</code> to generate an image</li>
              <li><strong>Gordy can make mistakes</strong></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="down-screen" style="display: none;">
      üòî Gordy is currently down. <br>
      I'm working on a fix üîß. Please check back later.
    </div>

    <script>
      const isDown = false; // Set to true to show or false to hide

      document.addEventListener('DOMContentLoaded', function() {
        const downScreen = document.querySelector('.down-screen');
        downScreen.style.display = isDown ? 'flex' : 'none';
      });
    </script>

    <div class="chat-area glass-panel">
      <div class="messages-container no-chat" id="messages">
        <div class="greeting" id="greeting-message"></div>
        <h2 class="homepage-heading" id="homepage-heading">What can I help you with today?</h2>
        <div class="input-area-home">
          <textarea id="user-input-home" placeholder="Ask Gordy" rows="1"></textarea>
          <div class="home-send-btn" onclick="startNewChatAndSendHome()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
            </svg>
          </div>
        </div>
        <div class="examples-section">
          <div class="examples-title">Examples</div>
          <div class="examples-grid" id="dynamic-examples-grid"></div>
        </div>
      </div>

      <div class="input-area" id="input-area" style="display: none;">
        <!-- Dropdown for extra commands -->
        <div class="dropdown-container" style="position: relative; display: inline-block;">
          <button class="dropdown-toggle" onclick="toggleDropdown()" title="Options">
            ‚ò∞
          </button>
          <div id="dropdown-menu" style="display: none; position: absolute; bottom: 100%; left: 0; z-index: 1000; min-width: 140px;">
            <!-- Removed File Upload option -->
            <button onclick="toggleCommand('/search')" style="display: flex; align-items: center; gap: 5px;">
              <svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-[18px] w-[18px]">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m9.985-7.997L12 4l.015.003a.3.3 0 0 1 .064.03c.13.08.347.291.596.744.241.438.473 1.028.674 1.756.336 1.22.567 2.759.632 4.467h-3.962c.065-1.708.296-3.247.632-4.467.201-.728.433-1.318.674-1.756.25-.453.466-.665.596-.743a.3.3 0 0 1 .064-.031M8.018 11c.066-1.867.316-3.588.705-5 .15-.544.325-1.054.522-1.513A8.01 8.01 0 0 0 4.062 11zm-3.956 2h3.956c.077 2.174.404 4.156.912 5.68q.144.435.315.833A8.01 8.01 0 0 1 4.062 13m5.957 0h3.962c-.076 1.997-.378 3.757-.808 5.048-.252.756-.53 1.296-.79 1.626a1.2 1.2 0 0 1-.302.29.3.3 0 0 1-.066.033L12 20l-.015-.003a.3.3 0 0 1-.066-.032 1.2 1.2 0 0 1-.301-.291c-.26-.33-.539-.87-.79-1.626-.43-1.29-.732-3.05-.809-5.048m5.963 0c-.077 2.174-.404 4.156-.912 5.68q-.144.435-.315.833A8.01 8.01 0 0 0 19.938 13zm3.956-2a8.01 8.01 0 0 0-5.183-6.513c.197.46.371.969.522 1.514.389 1.41.639 3.132.705 4.999z" fill="currentColor"/>
              </svg>
              Search
            </button>
            <button onclick="toggleCommand('/image')" style="display: flex; align-items: center; gap: 5px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-[18px] w-[18px]">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Z" />
              </svg>
              Image
            </button>
          </div>
        </div>
        <textarea id="user-input" placeholder="Ask Gordy" rows="1"></textarea>
        <div class="send-btn" onclick="sendMessage()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
          </svg>
        </div>
        <div class="modal-overlay-preview" id="code-preview-modal" style="display: none;">
          <div class="modal-preview">
            <button class="close-preview-btn" onclick="closeCodePreview()">Close</button>
            <iframe id="code-preview-iframe" sandbox="allow-scripts allow-same-origin" frameborder="0"></iframe>
          </div>
        </div>
      </div>
      
      <script>
        function toggleDropdown() {
          var menu = document.getElementById('dropdown-menu');
          menu.style.display = (menu.style.display === 'none' || menu.style.display === '') ? 'block' : 'none';
        }

        function toggleCommand(cmd) {
          var input = document.getElementById('user-input');
          var current = input.value.trim();
          if (current === cmd) {
            input.value = "";
          } else {
            input.value = cmd + " ";
          }
        }

        document.addEventListener('click', function(event) {
          var dropdownContainer = document.querySelector('.dropdown-container');
          if (!dropdownContainer.contains(event.target)) {
            document.getElementById('dropdown-menu').style.display = 'none';
          }
        });
      </script>

      <div class="modal-overlay" id="auth-modal" style="display:none;">
        <div class="modal">
          <h2 id="auth-modal-title">Login</h2>
          <div class="error-message" id="auth-error" style="display:none;"></div>
          <input type="text" id="username" placeholder="Username">
          <input type="password" id="password" placeholder="Password">
          <input type="password" id="confirm-password" placeholder="Confirm Password" style="display:none;">
          <button id="auth-submit-btn">Login</button>
          <span class="toggle-link" id="toggle-auth-mode">No account? Sign up</span>
        </div>
      </div>

      <script>
        //Home Screen Chat Suggestions
        const allSuggestions = [
          "Explain quantum computing in simple terms",
          "Write a Python script that sorts a list",
          "How do I fix my code performance issues?",
          "How do I set up a Flask application?",
          "How can I optimize my database queries?",
          "What is the difference between REST and GraphQL?",
          "Give me some tips on writing clean code",
          "Show me how to unit test a JavaScript function",
          "Explain microservices architecture",
          "How do I debug memory leaks in C++?",
          "What are the best practices for secure coding?",
          "How do I implement authentication in a Node.js application?",
          "Explain the concept of dependency injection",
          "How do I use Docker to containerize my application?",
          "What are the differences between monolithic and microservices architecture?",
          "How do I optimize the performance of a React application?",
          "Explain the concept of Big O notation",
          "How do I use Git to manage my code repository?",
          "What are the best practices for coding interviews?",
          "How do I implement a state machine in JavaScript?",
          "Explain the concept of recursion",
          "How do I use TypeScript to improve my JavaScript code",
          "What are the differences between SQL and NoSQL databases?",
          "How do I implement caching in a web application?",
          "Explain the concept of concurrency in programming",
          "How do I use AWS to deploy my application?",
          "What are the best practices for testing a web application?",
          "How do I implement a CI/CD pipeline using Jenkins",
          "Explain the concept of design patterns in software development",
          "How do I use MongoDB to store and retrieve data",
          "What are the differences between Java and Kotlin",
          "How do I implement a chatbot using natural language processing",
          "Explain the concept of machine learning",
          "How do I use TensorFlow to build a neural network",
          "What are the best practices for coding in a team environment",
          "How do I implement a RESTful API using Express.js",
          "Explain the concept of web sockets",
          "How do I use Redis to improve the performance of my application",
          "What are the differences between Vue.js and Angular",
          "How do I implement a single-page application using React",
          "Explain the concept of serverless computing",
          "How do I use Azure to deploy my application",
          "What are the best practices for coding for accessibility",
          "How do I implement a progressive web app",
          "Explain the concept of DevOps",
          "How do I use Kubernetes to manage my containerized application"
        ];
        function getRandomSuggestions(count) {
          let cloned = [...allSuggestions];
          for (let i = cloned.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [cloned[i], cloned[j]] = [cloned[j], cloned[i]];
          }
          return cloned.slice(0, count);
        }
        let currentChat = [];
        let chatHistory = [];
        let currentUser = null;
        let authMode = 'login';
        let currentChatTitle = "New Chat";
        let currentChatIndex = null;
        let selectedModel = 'default';

        function toggleSidebar() {
          const sidebar = document.getElementById('sidebar');
          const appContainer = document.querySelector('.app-container');
          const topNavHamburger = document.querySelector('.top-nav .hamburger');
          const topNewChatBtn = document.getElementById('top-new-chat-btn');
          sidebar.classList.toggle('collapsed');
          appContainer.classList.toggle('sidebar-open');
          if (appContainer.classList.contains('sidebar-open')) {
            topNavHamburger.style.display = 'none';
            topNewChatBtn.style.display = 'none';
          } else {
            topNavHamburger.style.display = 'block';
            topNewChatBtn.style.display = 'block';
          }
          const chatArea = document.querySelector('.chat-area');
          if (appContainer.classList.contains('sidebar-open')) {
            chatArea.style.marginLeft = '260px';
            chatArea.style.width = `calc(100% - 260px)`;
          } else {
            chatArea.style.marginLeft = '0';
            chatArea.style.width = '100%';
          }
        }
        function getAccounts() {
          return JSON.parse(localStorage.getItem('accounts') || '{}');
        }
        function saveAccounts(accounts) {
          localStorage.setItem('accounts', JSON.stringify(accounts));
        }
        function showAuthModal() {
          document.getElementById('auth-modal').style.display = 'flex';
        }
        function hideAuthModal() {
          document.getElementById('auth-modal').style.display = 'none';
        }
        function checkAuth() {
          const user = localStorage.getItem('loggedInUser');
          if (user) {
            currentUser = user;
            loadUserData();
            document.getElementById('logout-btn').classList.remove('hidden');
            document.getElementById('user-status').classList.remove('hidden');
            document.getElementById('user-status').textContent = '';
            document.getElementById('logout-btn').addEventListener('click', logout);
          } else {
            currentUser = null;
            document.getElementById('logout-btn').classList.add('hidden');
            document.getElementById('user-status').classList.add('hidden');
            showAuthModal();
          }
        }
        function loadUserData() {
          const accounts = getAccounts();
          const userData = accounts[currentUser] || { password:'', chats:[], selectedModel: 'default' };
          chatHistory = userData.chats.map(chat => {
            return { title: chat.title || "New Chat", messages: chat.messages };
          });
          selectedModel = userData.selectedModel || 'default';
          document.getElementById('model-select').value = selectedModel;
          updateSidebar();
          if (chatHistory.length === 0) {
            showNoChatState();
          } else {
            loadLastActiveChat();
          }
        }
        function loadLastActiveChat() {
          const lastIndex = chatHistory.length - 1;
          if (lastIndex >= 0) {
            loadChat(lastIndex);
          } else {
            showNoChatState();
          }
        }
        function getGreeting() {
          const now = new Date();
          const hour = now.getHours();
          if (hour < 12) return 'Good morning';
          if (hour < 17) return 'Good afternoon';
          return 'Good evening';
        }
        function showNoChatState() {
          const greeting = getGreeting();
          const messagesContainer = document.getElementById('messages');
          messagesContainer.innerHTML = `
                <div class="greeting" id="greeting-message">${greeting}, ${currentUser}!</div>
                <h2 class="homepage-heading" id="homepage-heading">What can I help you with today?</h2>
                <div class="input-area-home">
                    <textarea id="user-input-home" placeholder="Message Gordy" rows="1"></textarea>
                    <div class="home-send-btn" onclick="startNewChatAndSendHome()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                        </svg>
                    </div>
                </div>
                <div class="examples-section">
                    <div class="examples-title">Examples</div>
                    <div class="examples-grid" id="dynamic-examples-grid"></div>
                </div>
            `;
          messagesContainer.classList.add('no-chat');
          currentChat = [];
          currentChatTitle = "New Chat";
          currentChatIndex = null;
          document.getElementById('input-area').style.display = 'none';
          updateMessageCount();
          const randomSugs = getRandomSuggestions(3);
          const examplesGrid = document.getElementById('dynamic-examples-grid');
          randomSugs.forEach(suggestion => {
            const exampleCard = document.createElement('div');
            exampleCard.classList.add('example-card');
            exampleCard.setAttribute('onclick', `sendSuggestion('${ suggestion.replace(/'/g, "\\'") }')`);
            exampleCard.innerHTML = `
                    <svg class="example-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 16h8v2H8v-2zm0-4h8v2H8v-2zm0-4h8v2H8V8z"/>
                    </svg>
                    <span>${ suggestion }</span>
                `;
            examplesGrid.appendChild(exampleCard);
          });
        }
        function showInputArea() {
          document.getElementById('input-area').style.display = 'flex';
        }
        function saveUserData() {
          if (!currentUser) return;
          const accounts = getAccounts();
          if (!accounts[currentUser]) {
            accounts[currentUser] = { password:'', chats:[], selectedModel: 'default' };
          }
          accounts[currentUser].chats = chatHistory.map(chat => ({
            title: chat.title,
            messages: chat.messages
          }));
          accounts[currentUser].selectedModel = selectedModel;
          saveAccounts(accounts);
        }
        function login(username, password) {
          const accounts = getAccounts();
          if (accounts[username] && accounts[username].password === password) {
            currentUser = username;
            localStorage.setItem('loggedInUser', username);
            loadUserData();
            hideAuthModal();
            updateUserAvatar();
          } else {
            showError('Invalid credentials');
          }
        }
        function signup(username, password, confirmPassword) {
          if (password !== confirmPassword) {
            showError('Passwords do not match');
            return;
          }
          const accounts = getAccounts();
          if (accounts[username]) {
            showError('Username already exists');
            return;
          }
          accounts[username] = { password: password, chats: [], selectedModel: 'default' };
          saveAccounts(accounts);
          currentUser = username;
          localStorage.setItem('loggedInUser', username);
          loadUserData();
          hideAuthModal();
          document.getElementById('logout-btn').classList.remove('hidden');
        }
        function logout() {
          localStorage.removeItem('loggedInUser');
          location.reload();
        }
        async function startNewChatAndSendHome() {
          const userInputHome = document.getElementById('user-input-home').value.trim();
          if (!userInputHome) return;
          await startNewChat();
          showInputArea();
          document.getElementById('user-input').value = userInputHome;
          adjustTextareaHeight(document.getElementById('user-input'));
          sendMessage();
        }
        async function startNewChat() {
          currentChat = [];
          currentChatTitle = "New Chat";
          const newChat = { title: currentChatTitle, messages: currentChat };
          chatHistory.push(newChat);
          saveUserData();
          updateSidebar();
          currentChatIndex = chatHistory.length - 1;
          loadChat(currentChatIndex);
        }
        async function sendMessage() {
          if (!currentUser) {
            alert('Please log in first.');
            return;
          }
          const userInputElem = document.getElementById('user-input');
          const userInput = userInputElem.value.trim();
          if (!userInput) return;
          if (currentChatIndex === null) {
            alert('No chat selected. Click "New Chat" to begin.');
            return;
          }
          const messagesContainer = document.getElementById('messages');
          messagesContainer.classList.remove('no-chat');
          let combinedContent = userInput;
          const userMessage = document.createElement('div');
          userMessage.classList.add('message', 'user-message');
          userMessage.innerHTML = `
            <div class="user-text">${combinedContent}</div>
            <button class="unsend-btn" title="Unsend message">√ó</button>
          `;
          const unsendBtn = userMessage.querySelector('.unsend-btn');
          unsendBtn.onclick = (e) => {
            e.stopPropagation();
            unsendMessage(userMessage);
          };
          messagesContainer.appendChild(userMessage);
          currentChat.push({ role: 'user', content: combinedContent });
          userInputElem.value = '';
          adjustTextareaHeight(userInputElem);
          scrollToBottom();
          updateMessageCount();
          if (currentChat.length === 1 && currentChat[0].role === 'user') {
            try {
              const titleResponse = await fetch('/generate_title', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: userInput }),
              });
              const titleData = await titleResponse.json();
              if (titleData.title) {
                currentChatTitle = titleData.title;
                chatHistory[currentChatIndex].title = titleData.title;
                saveUserData();
                updateSidebar();
              }
            } catch (error) {
              console.error('Error during title generation:', error);
            }
          }
          const loadingMessage = document.createElement('div');
          loadingMessage.classList.add('message', 'ai-message');
          loadingMessage.innerHTML = `
            <img src="static/logo.png" class="loading-logo" alt="Loading Logo">
            <div>
              <span id="thinking-text" class="thinking-text">
                Gordy is thinking
              </span>
              <span class="advanced-spinner">
                <div class="layer">
                  <div class="shape"></div>
                  <div class="shape" style="animation-delay: -3s;"></div>
                </div>
                <div class="layer">
                  <div class="shape"></div>
                  <div class="shape" style="animation-delay: -2s;"></div>
                </div>
                <div class="layer">
                  <div class="shape"></div>
                  <div class="shape" style="animation-delay: -1s;"></div>
                </div>
                <div class="layer">
                  <div class="shape"></div>
                </div>
              </span>
            </div>
          `;
          
          messagesContainer.appendChild(loadingMessage);
          scrollToBottom();
          
          let textInterval;
          if (localStorage.getItem('enableVerification') === 'true') {
            const thinkingText = document.getElementById('thinking-text');
            thinkingText.textContent = 'Gordy is thinking';
            
            setTimeout(() => {
              thinkingText.textContent = 'Gordy is verifying';
              textInterval = setInterval(() => {
                thinkingText.textContent = thinkingText.textContent === 'Gordy is thinking' 
                  ? 'Gordy is verifying' 
                  : 'Gordy is thinking';
              }, 10000);
            }, 10000);
          }
        
          try {
            const response = await fetch('/chat', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                prompt: userInput,
                model: selectedModel,
                username: currentUser,
                enable_verification: localStorage.getItem('enableVerification') === 'true'
              })
            });
        
            if (textInterval) {
              clearInterval(textInterval);
            }
        
            const data = await response.json();
            loadingMessage.remove();
        
            if (data.error) {
              const errorMsg = document.createElement('div');
              errorMsg.classList.add('message', 'ai-message', 'text-red-400');
              errorMsg.textContent = data.error;
              messagesContainer.appendChild(errorMsg);
              return;
            }
        
            if (data.thinking_steps) {
              const verificationStatus = document.createElement('div');  
              verificationStatus.classList.add('message', 'ai-message');
              verificationStatus.innerHTML = data.thinking_steps;
              messagesContainer.appendChild(verificationStatus);
            }
        
            const aiMessageContainer = document.createElement('div');
            aiMessageContainer.classList.add('message', 'ai-message');
            aiMessageContainer.innerHTML = `
              <img src="static/logo.png" class="ai-avatar" alt="AI Avatar">
              <div class="ai-text">${formatText(data.response)}</div>
            `;
        
            messagesContainer.appendChild(aiMessageContainer);
            currentChat.push({ role: 'assistant', content: data.response });
            saveChat();
            scrollToBottom();
            
          } catch (error) {
            console.error('Error:', error);
            loadingMessage.remove();
            const errorMsg = document.createElement('div');
            errorMsg.classList.add('message', 'ai-message', 'text-red-400');
            errorMsg.textContent = 'Error communicating with Gordy';
            messagesContainer.appendChild(errorMsg);
          }
        }
        function sendSuggestion(text) {
          if (currentChatIndex === null) {
            startNewChat();
          }
          showInputArea();
          document.getElementById('user-input').value = text;
          adjustTextareaHeight(document.getElementById('user-input'));
          sendMessage();
        }
        document.getElementById('model-select').addEventListener('change', function() {
          selectedModel = this.value;
          saveUserData();
          if (selectedModel === 'experimental') {
            document.getElementById('experimental-features').classList.remove('hidden');
          } else {
            document.getElementById('experimental-features').classList.add('hidden');
          }
        });
        function unsendMessage(userMessageDiv) {
          const messagesContainer = document.getElementById('messages');
          const allMessages = Array.from(messagesContainer.children);
          const userMsgIndex = allMessages.indexOf(userMessageDiv);
          if (userMsgIndex === -1) return;
          currentChat.splice(Math.floor(userMsgIndex / 2), 1);
          userMessageDiv.remove();
          const nextMessage = allMessages[userMsgIndex + 1];
          if (nextMessage && nextMessage.classList.contains('ai-message')) {
            const aiContent = getAIContent(nextMessage);
            currentChat.splice(Math.floor(userMsgIndex / 2), 0, { role: 'assistant', content: aiContent });
            nextMessage.remove();
          }
          updateMessageCount();
          saveChat();
          if (currentChat.length === 0) {
            showNoChatState();
          }
        }
        function getAIContent(aiMessageDiv) {
          const aiTextDiv = aiMessageDiv.querySelector('.ai-text');
          return aiTextDiv ? aiTextDiv.innerText : '';
        }
        function escapeHtml(unsafe) {
          return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
        }
        function formatText(text) {
          let thinkingContent = '';
          
          function extractThinking(text) {
            return text.replace(/<thinking>([\s\S]*?)<\/thinking>/g, (match, content) => {
              thinkingContent += (thinkingContent ? '\n\n' : '') + content.trim();
              return '';
            });
          }
          
          text = extractThinking(text);
          
          text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
            code = extractThinking(code);
            
            const escapedCode = escapeHtml(code.trim());
            return `
              <div class="code-block relative">
                <button class="copy-button" onclick="copyCode(this)" title="Copy Code">Copy</button>
                <button class="preview-button" onclick="previewCode(this)" title="Preview Code">Preview</button>
                <pre class="text-gray-200 overflow-x-auto">
                  <code class="language-${lang || 'plain'}" style="white-space: pre;">${escapedCode}</code>
                </pre>
              </div>
            `;
          });
        
          text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
          
          text = text.replace(/`([^`]+)`/g, '<code class="bg-gray-800 text-red-400 px-1 rounded">$1</code>');
          
          if (thinkingContent) {
            return `
              <div class="thinking-header">
                <button class="thinking-button" onclick="toggleThinking(this)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                  </svg>
                  Show thinking
                </button>
              </div>
              <div class="thinking-content">${thinkingContent}</div>
              ${text}`;
          }
          
          return text;
        }
        
        function toggleThinking(button) {
          const content = button.closest('.thinking-header').nextElementSibling;
          const isVisible = content.style.display === 'block';
          content.style.display = isVisible ? 'none' : 'block';
          button.innerHTML = isVisible ? 
            `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
              <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
              <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.064 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
            </svg>Show thinking` : 
            `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
              <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.064 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
            </svg>Hide thinking`;
        }
        
        function copyCode(button) {
          const codeElement = button.closest('.code-block').querySelector('code');
          const code = codeElement.innerText;
          const tempTextArea = document.createElement('textarea');
          tempTextArea.value = code;
          document.body.appendChild(tempTextArea);
          tempTextArea.select();
          document.execCommand('copy');
          document.body.removeChild(tempTextArea);
          const feedback = document.createElement('div');
          feedback.className = 'copied-feedback';
          feedback.textContent = 'Copied!';
          button.closest('.code-block').appendChild(feedback);
          setTimeout(() => {
            feedback.remove();
          }, 2000);
        }
        function scrollToBottom() {
          const messagesContainer = document.getElementById('messages');
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        function saveChat() {
          if (!currentUser) return;
          if (currentChatIndex === null) return;
          chatHistory[currentChatIndex].title = currentChatTitle;
          chatHistory[currentChatIndex].messages = currentChat;
          saveUserData();
          updateSidebar();
        }
        function postLatestVideo(videoUrl) {
          const videoContainer = document.getElementById('video-container');
          videoContainer.innerHTML = '';
          const videoElement = document.createElement('video');
          videoElement.src = videoUrl;
          videoElement.controls = true;
          videoContainer.appendChild(videoElement);
        }
        function previewCode(button) {
          const codeBlock = button.closest('.code-block');
          if (!codeBlock) return;
          const codeElement = codeBlock.querySelector('code');
          if (!codeElement) return;
          const language = codeElement.classList.contains('language-html') ? 'html' :
                          codeElement.classList.contains('language-css') ? 'css' :
                          codeElement.classList.contains('language-js') ? 'js' : 'plain';
          const codeContent = codeElement.innerText;
          let htmlContent = '';
          let cssContent = '';
          let jsContent = '';
          if (language === 'html') {
            htmlContent = codeContent;
          } else if (language === 'css') {
            cssContent = `<style>${codeContent}</style>`;
          } else if (language === 'js') {
            jsContent = `<script>${codeContent}<\/script>`;
          } else {
            htmlContent = `<pre>${escapeHtml(codeContent)}</pre>`;
          }
          if (language === 'plain') {
            const parser = new DOMParser();
            const doc = parser.parseFromString(codeContent, 'text/html');
            htmlContent = doc.body.innerHTML;
            const styles = doc.querySelectorAll('style');
            styles.forEach(style => {
              cssContent += style.outerHTML;
            });
            const scripts = doc.querySelectorAll('script');
            scripts.forEach(script => {
              jsContent += script.outerHTML;
            });
          }
          const combinedContent = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <title>Code Preview</title>
                    ${cssContent}
                </head>
                <body>
                    ${htmlContent}
                    ${jsContent}
                </body>
                </html>
            `;
          const iframe = document.getElementById('code-preview-iframe');
          iframe.srcdoc = combinedContent;
          const modal = document.getElementById('code-preview-modal');
          modal.style.display = 'flex';
        }
        function closeCodePreview() {
          const modal = document.getElementById('code-preview-modal');
          modal.style.display = 'none';
          const iframe = document.getElementById('code-preview-iframe');
          iframe.srcdoc = '';
        }
        function updateSidebar() {
          const chatList = document.getElementById('chat-list');
          chatList.innerHTML = '';
          for (let i = 0; i < chatHistory.length; i++) {
            const chatObj = chatHistory[i];
            const chatItem = document.createElement('div');
            chatItem.classList.add('chat-history-item');
            if (i === currentChatIndex) {
              chatItem.classList.add('selected');
            }
            chatItem.innerHTML = `
                    <div class="chat-title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-400 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7 2a1 1 0 011 1v1h3V3a1 1 0 112 0v1h2a2 2 0 012 2v12a2 2 0 01-2 2H7a2 2 0 01-2-2V6a2 2 0 012-2h2V3a1 1 0 011-1zm3 4V3H7v3h6z" clip-rule="evenodd" />
                        </svg>
                        <span>${escapeHtml(chatObj.title || "New Chat")}</span>
                    </div>
                    <button class="options-btn" onclick="toggleOptionsMenu(event)">‚ãÆ</button>
                    <div class="options-menu">
                        <button onclick="renameChat(${i})">Rename Chat</button>
                        <button onclick="deleteChat(${i})">Delete Chat</button>
                    </div>
                `;
            chatItem.onclick = (e) => {
              if (!e.target.closest('.options-btn') && !e.target.closest('.options-menu')) {
                loadChat(i);
              }
            };
            chatList.appendChild(chatItem);
          }
        }
        function toggleOptionsMenu(event) {
          event.stopPropagation();
          closeAllMenus();
          const menu = event.target.parentElement.querySelector('.options-menu');
          if (menu) {
            menu.style.display = 'flex';
            document.addEventListener('click', onDocumentClick);
          }
        }
        function closeAllMenus() {
          const menus = document.querySelectorAll('.options-menu');
          menus.forEach(m => m.style.display = 'none');
          document.removeEventListener('click', onDocumentClick);
        }
        function onDocumentClick(e) {
          if (!e.target.closest('.options-menu')) {
            closeAllMenus();
          }
        }
        function renameChat(index) {
          closeAllMenus();
          const newName = prompt("Enter new chat name:", chatHistory[index].title);
          if (newName !== null) {
            const trimmed = newName.trim() || "New Chat";
            chatHistory[index].title = trimmed;
            saveUserData();
            updateSidebar();
            if (index === currentChatIndex) {
              currentChatTitle = trimmed;
            }
          }
        }
        function deleteChat(index) {
          closeAllMenus();
          chatHistory.splice(index, 1);
          saveUserData();
          updateSidebar();
          if (index === currentChatIndex) {
            showNoChatState();
          }
        }
        function loadChat(index) {
          const chatListItems = document.querySelectorAll('.chat-history-item');
          chatListItems.forEach((item, i) => {
            if (i === index) {
              item.classList.add('selected');
            } else {
              item.classList.remove('selected');
            }
          });
          currentChatIndex = index;
          const chatObj = chatHistory[index];
          currentChat = chatObj.messages;
          currentChatTitle = chatObj.title;
          const messagesContainer = document.getElementById('messages');
          messagesContainer.innerHTML = '';
          messagesContainer.classList.remove('no-chat');
          showInputArea();
          currentChat.forEach((msg) => {
            const messageDiv = document.createElement('div');
            if (msg.role === 'user') {
              messageDiv.classList.add('message', 'user-message');
              messageDiv.innerHTML = `
                        <div class="user-text">${escapeHtml(msg.content)}</div>
                        <button class="unsend-btn" title="Unsend message">√ó</button>
                    `;
              const unsendBtn = messageDiv.querySelector('.unsend-btn');
              unsendBtn.onclick = (e) => {
                e.stopPropagation();
                unsendMessage(messageDiv);
              };
            } else {
              messageDiv.classList.add('message', 'ai-message', 'text-gray-200');
              messageDiv.innerHTML = `
                        <img src="static/logo.png" class="ai-avatar" alt="AI Avatar">
                        <div class="ai-text">${formatText(msg.content)}</div>
                    `;
            }
            messagesContainer.appendChild(messageDiv);
          });
          scrollToBottom();
          updateMessageCount();
        }
        function updateMessageCount() {
          const messageCount = currentChat.length;
          document.getElementById('message-count').textContent = messageCount;
        }
        const toggleLink = document.getElementById('toggle-auth-mode');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authTitle = document.getElementById('auth-modal-title');
        const authError = document.getElementById('auth-error');
        const usernameField = document.getElementById('username');
        const passwordField = document.getElementById('password');
        const confirmPasswordField = document.getElementById('confirm-password');
        function showError(msg) {
          authError.textContent = msg;
          authError.style.display = 'block';
        }
        function clearError() {
          authError.textContent = '';
          authError.style.display = 'none';
        }
        toggleLink.addEventListener('click', () => {
          if (authMode === 'login') {
            authMode = 'signup';
            authTitle.textContent = 'Sign Up';
            authSubmitBtn.textContent = 'Sign Up';
            toggleLink.textContent = 'Already have an account? Login';
            confirmPasswordField.style.display = 'block';
          } else {
            authMode = 'login';
            authTitle.textContent = 'Login';
            authSubmitBtn.textContent = 'Login';
            toggleLink.textContent = 'No account? Sign up';
            confirmPasswordField.style.display = 'none';
          }
          clearError();
        });
        function authAction() {
          const usernameVal = usernameField.value.trim();
          const passwordVal = passwordField.value.trim();
          const confirmVal = confirmPasswordField.value.trim();
          if (!usernameVal || !passwordVal || (authMode === 'signup' && !confirmVal)) {
            showError('Please fill in all fields');
            return;
          }
          if (authMode === 'login') {
            login(usernameVal, passwordVal);
          } else {
            signup(usernameVal, passwordVal, confirmVal);
          }
        }
        authSubmitBtn.addEventListener('click', authAction);
        confirmPasswordField.addEventListener('keydown', e => {
          if (e.key === 'Enter') authAction();
        });
        passwordField.addEventListener('keydown', e => {
          if (e.key === 'Enter' && authMode === 'login') {
            authAction();
          }
        });
        usernameField.addEventListener('keydown', e => {
          if (e.key === 'Enter') passwordField.focus();
        });
        document.getElementById('user-input').addEventListener('keydown', function(event) {
          if (event.key === 'Enter') {
            if (event.shiftKey) {
              event.preventDefault();
              const cursorPos = this.selectionStart;
              const text = this.value;
              this.value = text.slice(0, cursorPos) + '\n' + text.slice(cursorPos);
              this.selectionStart = this.selectionEnd = cursorPos + 1;
              adjustTextareaHeight(this);
            } else {
              event.preventDefault();
              sendMessage();
            }
          }
        });
        document.getElementById('user-input-home').addEventListener('keydown', function(event) {
          if (event.key === 'Enter') {
            if (event.shiftKey) {
              event.preventDefault();
              const cursorPos = this.selectionStart;
              const text = this.value;
              this.value = text.slice(0, cursorPos) + '\n' + text.slice(cursorPos);
              this.selectionStart = this.selectionEnd = cursorPos + 1;
              adjustTextareaHeight(this);
            } else {
              event.preventDefault();
              startNewChatAndSendHome();
            }
          }
        });
        function adjustTextareaHeight(textarea) {
          textarea.style.height = 'auto';
          textarea.style.height = (textarea.scrollHeight) + 'px';
        }
        document.getElementById('user-input-home').addEventListener('input', function() {
          adjustTextareaHeight(this);
        });
        document.getElementById('user-input').addEventListener('input', function() {
          adjustTextareaHeight(this);
        });
        document.addEventListener('keydown', function(event) {
          if (event.key === 'Enter' && document.getElementById('user-input-home')) {
            const focusedElement = document.activeElement;
            if (focusedElement && focusedElement.id === 'user-input-home') {
              if (!event.shiftKey) {
                startNewChatAndSendHome();
              }
            }
          }
        });
        document.getElementById('new-chat-btn').addEventListener('click', () => {
          showNoChatState();
        });
        checkAuth();
        updateMessageCount();
        document.getElementById('top-new-chat-btn').addEventListener('click', function() {
          document.getElementById('new-chat-btn').click();
        });
        document.getElementById('experimental-search-btn').addEventListener('click', () => {
          const query = document.getElementById('experimental-search-input').value.trim();
          if (query) {
            if (currentChatIndex === null) {
              startNewChat();
            }
            showInputArea();
            const userInput = document.getElementById('user-input');
            userInput.value = `/search ${query}`;
            adjustTextareaHeight(userInput);
            sendMessage();
          }
        });
        function updateUserAvatar() {
          const username = localStorage.getItem('loggedInUser');
          if (username) {
            document.querySelector('.profile-avatar').textContent = username.charAt(0).toUpperCase();
          }
        }
        function toggleProfileMenu(event) {
          event.stopPropagation();
          const menu = document.getElementById('profile-menu');
          const isVisible = menu.style.display === 'block';
          menu.style.display = isVisible ? 'none' : 'block';
          if (!isVisible) {
            document.addEventListener('click', function closeMenu(e) {
              if (!e.target.closest('.profile-trigger')) {
                menu.style.display = 'none';
                document.removeEventListener('click', closeMenu);
              }
            });
          }
        }
        document.addEventListener('DOMContentLoaded', updateUserAvatar);

        let formatTableTimeout;
        const messagesContainer = document.getElementById('messages');
        const observer = new MutationObserver((mutations) => {
          if (formatTableTimeout) clearTimeout(formatTableTimeout);
          formatTableTimeout = setTimeout(() => {
            formatGeneratedTable();
          }, 100);
        });
        if (messagesContainer) {
          observer.observe(messagesContainer, { childList: true, subtree: true });
        }

        function cleanupBrBeforeTables() {
          const brsBeforeTables = document.querySelectorAll("br + table");
          brsBeforeTables.forEach(br => {
            br.remove();
          });
        }
        function formatGeneratedTable() {
          const tables = document.querySelectorAll("table");
          tables.forEach(table => {
            let previous = table.previousSibling;
            while (previous && previous.nodeType === Node.ELEMENT_NODE && previous.tagName.toLowerCase() === 'br') {
              let temp = previous.previousSibling;
              previous.remove();
              previous = temp;
            }
            previous = table.previousSibling;
            while (previous && previous.nodeType === Node.TEXT_NODE && /^\s*$/.test(previous.textContent)) {
              let temp = previous.previousSibling;
              previous.remove();
              previous = temp;
            }
            table.style.width = "100%";
            table.style.borderCollapse = "collapse";
            table.style.backgroundColor = "#282424";
            table.style.color = "#E0E0E0";
            table.style.textAlign = "left";
            table.style.borderRadius = "8px";
            table.style.overflow = "hidden";
            table.style.fontFamily = "Arial, sans-serif";
            table.style.margin = "0";
            table.style.padding = "0";
            table.querySelectorAll("th").forEach(th => {
              th.style.backgroundColor = "#403c3c";
              th.style.fontWeight = "bold";
              th.style.padding = "8px";
              th.style.border = "1px solid #585454";
              th.style.fontFamily = "Arial, sans-serif";
              th.style.margin = "0";
            });
            table.querySelectorAll("td").forEach(td => {
              td.style.padding = "8px";
              td.style.border = "1px solid #585454";
              td.style.fontFamily = "Arial, sans-serif";
              td.style.margin = "0";
            });
            table.querySelectorAll("tr:nth-child(even)").forEach(row => {
              row.style.backgroundColor = "#282424";
            });
            table.querySelectorAll("tr:last-child td").forEach(td => {
              td.style.backgroundColor = "#282424";
            });
            const parent = table.parentElement;
            if (parent) {
              parent.style.margin = "0";
              parent.style.padding = "0";
            }
          });
        }
      </script>
      <script>
        function customizeGordy() {
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `
                <div class="modal">
                    <h2>Customize Gordy</h2>
                    <div class="customize-options">
                        <div class="option">
                            <label>AI Model</label>
                            <select id="ai-model" class="model-select">
                                <option value="default">Orion (Default)</option>
                                <option value="advanced">Nebula (Advanced)</option>
                            </select>
                        </div>
                        <div class="option">
                            <label>Response Style In Beta</label>
                            <select id="response-style" class="settings-select">
                                <option value="detailed">Detailed</option>
                                <option value="concise">Concise</option>
                                <option value="technical">Technical</option>
                            </select>
                        </div>
                        <div class="option">
                            <label>Code Snippet Style In Beta</label>
                            <select id="code-style" class="settings-select">
                                <option value="default">Default</option>
                                <option value="modern">Modern</option>
                                <option value="minimal">Minimal</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button onclick="saveCustomization()" class="primary-btn">Save Changes</button>
                        <button onclick="this.closest('.modal-overlay').remove()" class="secondary-btn">Cancel</button>
                    </div>
                </div>
            `;
          document.body.appendChild(modal);
          const savedModel = localStorage.getItem('ai-model-preference') || 'default';
          const savedResponseStyle = localStorage.getItem('response-style-preference') || 'detailed';
          const savedCodeStyle = localStorage.getItem('code-style-preference') || 'default';
          document.getElementById('ai-model').value = savedModel;
          document.getElementById('response-style').value = savedResponseStyle;
          document.getElementById('code-style').value = savedCodeStyle;
        }
        function saveCustomization() {
          const model = document.getElementById('ai-model').value;
          const responseStyle = document.getElementById('response-style').value;
          const codeStyle = document.getElementById('code-style').value;
          localStorage.setItem('ai-model-preference', model);
          localStorage.setItem('response-style-preference', responseStyle);
          localStorage.setItem('code-style-preference', codeStyle);
          document.getElementById('model-select').value = model;
          applyCodeStyle(codeStyle);
          document.querySelector('.modal-overlay').remove();
        }
        function applyCodeStyle(style) {
          const codeBlocks = document.querySelectorAll('.code-block');
          codeBlocks.forEach(block => {
            block.classList.remove('default', 'modern', 'minimal');
            block.classList.add(style);
          });
        }
        function openSettings() {
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `
                <div class="modal">
                    <h2>Settings</h2>
                    <div class="settings-options">
                        <div class="option">
                            <label>Theme In Beta</label>
                            <select id="theme-select" class="settings-select">
                                <option value="dark">Dark Theme</option>
                                <option value="light">Light Theme</option>
                            </select>
                        </div>
                        <div class="option">
                            <label>Message Display In Beta</label>
                            <select id="message-display" class="settings-select">
                                <option value="comfortable">Comfortable</option>
                                <option value="compact">Compact</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button onclick="saveSettings()" class="primary-btn">Save Changes</button>
                        <button onclick="this.closest('.modal-overlay').remove()" class="secondary-btn">Cancel</button>
                    </div>
                </div>
            `;
          document.body.appendChild(modal);
          const savedTheme = localStorage.getItem('theme-preference') || 'dark';
          const savedDisplay = localStorage.getItem('message-display') || 'comfortable';
          document.getElementById('theme-select').value = savedTheme;
          document.getElementById('message-display').value = savedDisplay;
        }
        function saveSettings() {
          const theme = document.getElementById('theme-select').value;
          const messageDisplay = document.getElementById('message-display').value;
          localStorage.setItem('theme-preference', theme);
          localStorage.setItem('message-display', messageDisplay);
          applySettings(theme, messageDisplay);
          document.querySelector('.modal-overlay').remove();
        }
        function applySettings(theme, messageDisplay) {
          document.body.className = theme;
          const messages = document.querySelectorAll('.message');
          messages.forEach(msg => {
            msg.classList.remove('compact', 'comfortable');
            msg.classList.add(messageDisplay);
          });
          const selects = document.querySelectorAll('.model-select, .settings-select');
          selects.forEach(select => {
            select.style.backgroundColor = theme === 'dark' ? 'rgba(0, 0, 0, 0.3)' : 'rgba(255, 255, 255, 0.9)';
            select.style.color = theme === 'dark' ? '#fff' : '#333';
          });
        }
        document.addEventListener('DOMContentLoaded', () => {
          const savedTheme = localStorage.getItem('theme-preference') || 'dark';
          const savedDisplay = localStorage.getItem('message-display') || 'comfortable';
          applySettings(savedTheme, savedDisplay);
        });
      </script>
    </div>
  </div>
</body>
</html>
